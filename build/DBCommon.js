Object.defineProperty(exports,"__esModule",{value:true});exports.DbConnect=exports.invokeMethod=exports.invoke=exports.getAggregates=exports.getTransformations=exports.getTriggers=exports.getModelFromType=exports.getReferenceTable=exports.getPostMethod=exports.getPreMethod=exports.getLastUpdatedBy=exports.getTable=exports.getReferenceModel=exports.getObjectId=exports.getVolatiles=exports.isVolatileField=exports.getUniqueObjectId=undefined;var _rhsCommon=require("rhs-common");var ObjectId=require("mongodb").ObjectID;var getUniqueObjectId=exports.getUniqueObjectId=function getUniqueObjectId(){return new ObjectId();};var isVolatileField=exports.isVolatileField=function isVolatileField(field,volatiles){return volatiles&&volatiles[field]?true:false;};var getVolatiles=exports.getVolatiles=function getVolatiles(model){return model._volatile;};var getObjectId=exports.getObjectId=function getObjectId(id){if(id&&!(id instanceof ObjectId)){try{id=new ObjectId(id);}catch(e){}}return id;};var getReferenceModel=exports.getReferenceModel=function getReferenceModel(field,schema){var refModel=schema[field];if(Array.isArray(refModel)){refModel=refModel[0];}if(typeof refModel=="function"){refModel=refModel();}if(!refModel){throw new Error("Model not found for field "+field);}return refModel;};var getTable=exports.getTable=function getTable(model){return model._table;};var getLastUpdatedBy=exports.getLastUpdatedBy=function getLastUpdatedBy(model){return model._lastUpdatedBy;};var getPreMethod=exports.getPreMethod=function getPreMethod(model){return model._preMethod;};var getPostMethod=exports.getPostMethod=function getPostMethod(model){return model._postMethod;};var getReferenceTable=exports.getReferenceTable=function getReferenceTable(field,schema){return getTable(getReferenceModel(field,schema));};var getModelFromType=exports.getModelFromType=function getModelFromType(type){if(typeof type=="function"){type=type();}return type;};var getTriggers=exports.getTriggers=function getTriggers(model){return model._triggers;};var getTransformations=exports.getTransformations=function getTransformations(model){var _transformations=model._transformations;return _transformations;};var getAggregates=exports.getAggregates=function getAggregates(model){var _aggregates=model._aggregates;return _aggregates;};var invoke=exports.invoke=function invoke(name,param,args){return _rhsCommon.Pipeline.of("invoke - "+name+" ").param({}).add(function(){return function(db){return db.invoke(name,param,args);};});};var invokeMethod=exports.invokeMethod=function invokeMethod(methods){return function(methodName,methodParams,args){if(methods[methodName]){return methods[methodName](methodParams,args);}throw new Error(methodName+" method not found");};};var DbConnect=exports.DbConnect=function DbConnect(nativeDB){return function(fn,data){if(fn&&fn._pipeline){return fn.init(nativeDB,data);}else{return fn(nativeDB,data);}};};